name: GPT-CMD Processor          # ← restores friendly name in sidebar

on:
  workflow_dispatch:            # ← REQUIRED for “Run workflow” button
    inputs:
      directives:
        description: 'JSON directives to apply (must be valid JSON)'
        required: true

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Write directives to file
        shell: bash
        run: |
          echo "${{ github.event.inputs.directives }}" > /tmp/directive.json

      - name: Debug directives
        shell: bash
        run: |
          echo '---RAW JSON START---'
          cat /tmp/directive.json
          echo '---RAW JSON END---'

      - name: Execute parser
        shell: bash
        run: |
          python3 scripts/parse_gpt_cmd.py < /tmp/directive.json